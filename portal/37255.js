(self.webpackChunkportal=self.webpackChunkportal||[]).push([[37255],{37255:(V,f,l)=>{l.d(f,{M:()=>B,x:()=>E});var c=l(81011),e=l(11705);let b=(()=>{class s{constructor(t){this.restService=t,this.apiName="AbpPermissionManagement",this.get=(n,i)=>this.restService.request({method:"GET",url:"/api/permission-management/permissions",params:{providerName:n,providerKey:i}},{apiName:this.apiName}),this.update=(n,i,a)=>this.restService.request({method:"PUT",url:"/api/permission-management/permissions",params:{providerName:n,providerKey:i},body:a},{apiName:this.apiName})}static#e=this.\u0275fac=function(n){return new(n||s)(e.\u0275\u0275inject(c.RestService))};static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var h=l(4125),m=l(32070),d=l(62411),_=l(36394),p=l(27437);const v=["selectAllInThisTabsRef"],C=["selectAllInAllTabsRef"];function x(s,r){if(1&s&&(e.\u0275\u0275elementStart(0,"h4"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"abpLocalization"),e.\u0275\u0275elementEnd()),2&s){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(2,2,"AbpPermissionManagement::Permissions")," - ",t.entityDisplayName||t.data.entityDisplayName," ")}}function y(s,r){if(1&s&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&s){const t=e.\u0275\u0275nextContext().ngIf;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("(",t.assignedCount,")")}}function T(s,r){if(1&s){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"a",24),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.onChangeGroup(i))})("select",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(a.setDisabled(i.permissions))}),e.\u0275\u0275elementStart(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275template(3,y,2,1,"span",1),e.\u0275\u0275elementEnd()()}if(2&s){const t=r.ngIf,n=e.\u0275\u0275nextContext().$implicit,i=e.\u0275\u0275nextContext(3);e.\u0275\u0275classProp("active",(null==i.selectedGroup?null:i.selectedGroup.name)===(null==n?null:n.name)),e.\u0275\u0275advance(1),e.\u0275\u0275classProp("font-weight-bold",t.assignedCount),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",null==n?null:n.displayName," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.assignedCount>0)}}const S=function(s){return{assignedCount:s}};function k(s,r){if(1&s&&(e.\u0275\u0275elementStart(0,"li",22),e.\u0275\u0275template(1,T,4,6,"a",23),e.\u0275\u0275elementEnd()),2&s){const t=r.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pureFunction1(1,S,n.getAssignedCount(t.name)))}}function M(s,r){if(1&s&&(e.\u0275\u0275elementStart(0,"span",30),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&s){const t=r.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.providerName,": ",t.providerKey,"")}}function P(s,r){if(1&s&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,M,2,2,"span",29),e.\u0275\u0275elementContainerEnd()),2&s){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.grantedProviders)}}function G(s,r){if(1&s){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",25)(1,"input",26,27),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit,o=e.\u0275\u0275reference(2),F=e.\u0275\u0275nextContext(3);return e.\u0275\u0275resetView(F.onClickCheckbox(a,o.value))}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"label",28),e.\u0275\u0275text(4),e.\u0275\u0275template(5,P,2,1,"ng-container",1),e.\u0275\u0275elementEnd()()}if(2&s){const t=r.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("ngStyle",t.style),e.\u0275\u0275advance(1),e.\u0275\u0275property("checked",n.getChecked(t.name))("value",n.getChecked(t.name))("disabled",n.isGrantedByOtherProviderName(t.grantedProviders)),e.\u0275\u0275attribute("id",t.name),e.\u0275\u0275advance(2),e.\u0275\u0275attribute("for",t.name),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",t.displayName," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.hideBadges)}}function N(s,r){if(1&s){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5)(1,"div",6)(2,"div",7)(3,"input",8,9),e.\u0275\u0275listener("ngModelChange",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.selectAllTab=i)})("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.onClickSelectAll())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"label",10),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"abpLocalization"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(8,"hr",11),e.\u0275\u0275elementStart(9,"div",12)(10,"ul",13),e.\u0275\u0275template(11,k,2,3,"li",14),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(12,"div",15)(13,"div",16)(14,"div",7)(15,"input",17,18),e.\u0275\u0275listener("ngModelChange",function(i){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(a.selectThisTab=i)})("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.onClickSelectThisTab())}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(17,"label",19),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"abpLocalization"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(20,"hr",20),e.\u0275\u0275template(21,G,6,8,"div",21),e.\u0275\u0275elementEnd()()()}if(2&s){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(3),e.\u0275\u0275property("ngModel",t.selectAllTab)("disabled",t.disabledSelectAllInAllTabs),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,10,"AbpPermissionManagement::SelectAllInAllTabs")),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t.data.groups)("ngForTrackBy",t.trackByFn),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngModel",t.selectThisTab)("disabled",t.disableSelectAllTab),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(19,12,"AbpPermissionManagement::SelectAllInThisTab")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.selectedGroupPermissions)("ngForTrackBy",t.trackByFn)}}function A(s,r){if(1&s){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",31),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"abp-button",32),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const i=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(i.submit())}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"abpLocalization"),e.\u0275\u0275elementEnd()}2&s&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,"AbpIdentity::Cancel")," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,4,"AbpIdentity::Save")))}function I(s,r){1&s&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,x,3,4,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(3,N,22,14,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(5,A,6,6,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementContainerEnd())}const w=function(){return{size:"lg"}};let B=(()=>{class s{get visible(){return this._visible}set visible(t){t!==this._visible&&(t?this.openModal().subscribe(()=>{this._visible=!0,this.visibleChange.emit(!0),(0,h.concat)(this.selectAllInAllTabsRef.changes,this.selectAllInThisTabsRef.changes).pipe((0,m.take)(1)).subscribe(()=>{this.initModal()})}):(this.setSelectedGroup(null),this._visible=!1,this.visibleChange.emit(!1)))}constructor(t,n){this.service=t,this.configState=n,this.hideBadges=!1,this._visible=!1,this.visibleChange=new e.EventEmitter,this.data={groups:[],entityDisplayName:""},this.permissions=[],this.selectThisTab=!1,this.selectAllTab=!1,this.disableSelectAllTab=!1,this.disabledSelectAllInAllTabs=!1,this.modalBusy=!1,this.selectedGroupPermissions=[],this.trackByFn=(i,a)=>a.name}getChecked(t){return(this.permissions.find(n=>n.name===t)||{isGranted:!1}).isGranted}setSelectedGroup(t){if(this.selectedGroup=t,!this.selectedGroup)return void(this.selectedGroupPermissions=[]);const n=`margin-${"rtl"===document.body.dir?"right":"left"}.px`,i=(this.data.groups.find(a=>a.name===this.selectedGroup?.name)||{}).permissions||[];this.selectedGroupPermissions=i.map(a=>({...a,style:{[n]:g(i,a)},isGranted:(this.permissions.find(o=>o.name===a.name)||{}).isGranted}))}setDisabled(t){this.disableSelectAllTab=!!t.length&&t.every(n=>n.isGranted&&n.grantedProviders?.every(i=>i.providerName!==this.providerName))}isGrantedByOtherProviderName(t){return!!t.length&&t.findIndex(n=>n.providerName!==this.providerName)>-1}onClickCheckbox(t){t.isGranted&&this.isGrantedByOtherProviderName(t.grantedProviders)||setTimeout(()=>{this.permissions=this.permissions.map(n=>t.name===n.name?{...n,isGranted:!n.isGranted}:t.name===n.parentName&&t.isGranted?{...n,isGranted:!1}:t.parentName!==n.name||t.isGranted?n:{...n,isGranted:!0}),this.setTabCheckboxState(),this.setGrantCheckboxState()},0)}setTabCheckboxState(){const t=this.selectedGroupPermissions.filter(a=>a.grantedProviders.every(o=>o.providerName===this.providerName)),n=t.filter(a=>a.isGranted),i=document.querySelector("#select-all-in-this-tabs");n.length===t.length?(i.indeterminate=!1,this.selectThisTab=!0):0===n.length?(i.indeterminate=!1,this.selectThisTab=!1):i.indeterminate=!0}setGrantCheckboxState(){const t=this.permissions.filter(a=>a.grantedProviders.every(o=>o.providerName===this.providerName)),n=t.filter(a=>a.isGranted),i=document.querySelector("#select-all-in-all-tabs");n.length===t.length?(i.indeterminate=!1,this.selectAllTab=!0):0===n.length?(i.indeterminate=!1,this.selectAllTab=!1):i.indeterminate=!0}onClickSelectThisTab(){this.selectedGroupPermissions.forEach(t=>{if(t.isGranted&&this.isGrantedByOtherProviderName(t.grantedProviders))return;const n=this.permissions.findIndex(i=>i.name===t.name);this.permissions=[...this.permissions.slice(0,n),{...this.permissions[n],isGranted:!this.selectThisTab},...this.permissions.slice(n+1)]}),this.setGrantCheckboxState()}onClickSelectAll(){this.permissions=this.permissions.map(t=>({...t,isGranted:this.isGrantedByOtherProviderName(t.grantedProviders)||!this.selectAllTab})),this.disableSelectAllTab||(this.selectThisTab=!this.selectAllTab,this.setTabCheckboxState())}onChangeGroup(t){this.setDisabled(t.permissions),this.setSelectedGroup(t),this.setTabCheckboxState()}submit(){const t=u(this.data.groups),n=this.permissions.filter(i=>(t.find(a=>a.name===i.name)||{}).isGranted!==i.isGranted).map(({name:i,isGranted:a})=>({name:i,isGranted:a}));n.length?(this.modalBusy=!0,this.service.update(this.providerName,this.providerKey,{permissions:n}).pipe((0,m.switchMap)(()=>this.shouldFetchAppConfig()?this.configState.refreshAppState():(0,h.of)(null)),(0,m.finalize)(()=>this.modalBusy=!1)).subscribe(()=>{this.visible=!1})):this.visible=!1}openModal(){if(!this.providerKey||!this.providerName)throw new Error("Provider Key and Provider Name are required.");return this.service.get(this.providerName,this.providerKey).pipe((0,m.tap)(t=>{this.data=t,this.permissions=u(t.groups),this.setSelectedGroup(t.groups[0]),this.disabledSelectAllInAllTabs=this.permissions.every(n=>n.isGranted&&n.grantedProviders.every(i=>i.providerName!==this.providerName))}))}initModal(){setTimeout(()=>{this.setDisabled(this.selectedGroup?.permissions||[]),this.setTabCheckboxState(),this.setGrantCheckboxState()})}getAssignedCount(t){return this.permissions.reduce((n,i)=>i.groupName===t&&i.isGranted?n+1:n,0)}shouldFetchAppConfig(){const t=this.configState.getOne("currentUser");return"R"===this.providerName?t.roles.some(n=>n===this.providerKey):"U"===this.providerName&&t.id===this.providerKey}static#e=this.\u0275fac=function(n){return new(n||s)(e.\u0275\u0275directiveInject(b),e.\u0275\u0275directiveInject(c.ConfigStateService))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:s,selectors:[["abp-permission-management"]],viewQuery:function(n,i){if(1&n&&(e.\u0275\u0275viewQuery(v,5),e.\u0275\u0275viewQuery(C,5)),2&n){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.selectAllInThisTabsRef=a),e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(i.selectAllInAllTabsRef=a)}},inputs:{providerName:"providerName",providerKey:"providerKey",hideBadges:"hideBadges",entityDisplayName:"entityDisplayName",visible:"visible"},outputs:{visibleChange:"visibleChange"},exportAs:["abpPermissionManagement"],decls:2,vars:5,consts:[[3,"visible","busy","options","visibleChange"],[4,"ngIf"],["abpHeader",""],["abpBody",""],["abpFooter",""],[1,"row"],[1,"col-md-4"],[1,"form-check","mb-2"],["type","checkbox","id","select-all-in-all-tabs","name","select-all-in-all-tabs",1,"form-check-input",3,"ngModel","disabled","ngModelChange","click"],["selectAllInAllTabsRef",""],["for","select-all-in-all-tabs",1,"form-check-label"],[1,"mt-2","mb-2"],[1,"overflow-auto"],[1,"nav","nav-pills","flex-column"],["class","nav-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-md-8","overflow-auto"],[1,"ps-1"],["type","checkbox","id","select-all-in-this-tabs","name","select-all-in-this-tabs",1,"form-check-input",3,"ngModel","disabled","ngModelChange","click"],["selectAllInThisTabsRef",""],["for","select-all-in-this-tabs",1,"form-check-label"],[1,"my-2"],["class","form-check mb-2",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"nav-item"],["class","nav-link pointer",3,"active","click","select",4,"ngIf"],[1,"nav-link","pointer",3,"click","select"],[1,"form-check","mb-2",3,"ngStyle"],["type","checkbox",1,"form-check-input",3,"checked","value","disabled","click"],["permissionCheckbox",""],[1,"form-check-label"],["class","badge bg-light text-dark",4,"ngFor","ngForOf"],[1,"badge","bg-light","text-dark"],["type","button","abpClose","",1,"btn","btn-secondary"],["iconClass","fa fa-check",3,"click"]],template:function(n,i){1&n&&(e.\u0275\u0275elementStart(0,"abp-modal",0),e.\u0275\u0275listener("visibleChange",function(o){return i.visible=o}),e.\u0275\u0275template(1,I,7,0,"ng-container",1),e.\u0275\u0275elementEnd()),2&n&&(e.\u0275\u0275property("visible",i.visible)("busy",i.modalBusy)("options",e.\u0275\u0275pureFunction0(4,w)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",i.data.entityDisplayName||i.entityDisplayName))},dependencies:[d.NgForOf,d.NgIf,d.NgStyle,_.CheckboxControlValueAccessor,_.NgControlStatus,_.NgModel,p.ButtonComponent,p.ModalComponent,p.ModalCloseDirective,c.LocalizationPipe],styles:[".overflow-scroll[_ngcontent-%COMP%]{max-height:70vh;overflow-y:scroll}"]})}return s})();function g(s,r){const t=s.find(n=>n.name===r.parentName);if(t&&t.parentName){let n=20;return n+=g(s,t)}return t?20:0}function u(s){return s.reduce((r,t)=>[...r,...t.permissions.map(n=>({...n,groupName:t.name||""}))],[])}let E=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.\u0275\u0275defineNgModule({type:s});static#n=this.\u0275inj=e.\u0275\u0275defineInjector({imports:[c.CoreModule,p.ThemeSharedModule]})}return s})()}}]);