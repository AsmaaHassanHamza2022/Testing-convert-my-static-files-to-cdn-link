(self.webpackChunkportal=self.webpackChunkportal||[]).push([[46674],{46674:(V,g,m)=>{m.r(g),m.d(g,{EmailSettingGroupComponent:()=>S,EmailSettingsService:()=>E,SETTING_MANAGEMENT_HAS_SETTING:()=>u,SETTING_MANAGEMENT_ROUTE_PROVIDERS:()=>b,SETTING_MANAGEMENT_SETTING_TAB_PROVIDERS:()=>_,SETTING_MANAGEMENT_VISIBLE_PROVIDERS:()=>I,SettingManagementConfigModule:()=>O,SettingTabsService:()=>c,configureRoutes:()=>f,configureSettingTabs:()=>v,setSettingManagementVisibility:()=>M});var s=m(27437),e=m(11705),i=m(36394),p=m(32070),l=m(81011),A=m(62411),d=m(74478),h=m(4125);function x(t,r){if(1&t){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",24),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const o=e.\u0275\u0275nextContext(2);return e.\u0275\u0275resetView(o.openSendEmailModal())}),e.\u0275\u0275element(1,"i",25),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"abpLocalization"),e.\u0275\u0275elementEnd()}2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"AbpSettingManagement::SendTestEmail")," "))}const y=function(){return{time:"200ms",easing:"linear"}},C=function(t,r){return{value:t,params:r}};function D(t,r){if(1&t){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",6),e.\u0275\u0275listener("ngSubmit",function(){e.\u0275\u0275restoreView(n);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.submit())}),e.\u0275\u0275elementStart(1,"div",7)(2,"label",8),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"abpLocalization"),e.\u0275\u0275elementStart(5,"span",9),e.\u0275\u0275text(6,"*"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(7,"input",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",7)(9,"label",8),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"abpLocalization"),e.\u0275\u0275elementStart(12,"span",9),e.\u0275\u0275text(13,"*"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(14,"input",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"div",7)(16,"label",8),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(19,"input",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",7)(21,"label",8),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"abpLocalization"),e.\u0275\u0275elementStart(24,"span",9),e.\u0275\u0275text(25,"*"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(26,"input",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(27,"div",14),e.\u0275\u0275element(28,"input",15),e.\u0275\u0275elementStart(29,"label",16),e.\u0275\u0275text(30),e.\u0275\u0275pipe(31,"abpLocalization"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(32,"div",14),e.\u0275\u0275element(33,"input",17),e.\u0275\u0275elementStart(34,"label",18),e.\u0275\u0275text(35),e.\u0275\u0275pipe(36,"abpLocalization"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(37,"div")(38,"div",7)(39,"label",8),e.\u0275\u0275text(40),e.\u0275\u0275pipe(41,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(42,"input",19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(43,"div",7)(44,"label",8),e.\u0275\u0275text(45),e.\u0275\u0275pipe(46,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(47,"input",20),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(48,"div",7)(49,"label",8),e.\u0275\u0275text(50),e.\u0275\u0275pipe(51,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(52,"input",21),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(53,"hr"),e.\u0275\u0275elementStart(54,"button",22),e.\u0275\u0275text(55),e.\u0275\u0275pipe(56,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(57,x,4,3,"button",23),e.\u0275\u0275elementEnd()}if(2&t){const n=e.\u0275\u0275nextContext();let a;e.\u0275\u0275property("formGroup",n.form)("validateOnSubmit",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,14,"AbpSettingManagement::DefaultFromDisplayName")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,16,"AbpSettingManagement::DefaultFromAddress")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,18,"AbpSettingManagement::SmtpHost")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(23,20,"AbpSettingManagement::SmtpPort")),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(31,22,"AbpSettingManagement::SmtpEnableSsl")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(36,24,"AbpSettingManagement::SmtpUseDefaultCredentials")),e.\u0275\u0275advance(2),e.\u0275\u0275property("@collapse",e.\u0275\u0275pureFunction2(35,C,null!=(a=n.form.get("smtpUseDefaultCredentials"))&&a.value?"collapsed":"expanded",e.\u0275\u0275pureFunction0(34,y))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(41,26,"AbpSettingManagement::SmtpDomain")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(46,28,"AbpSettingManagement::SmtpUserName")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(51,30,"AbpSettingManagement::SmtpPassword")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(56,32,"AbpSettingManagement::Save")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("abpPermission",n.emailingPolicy)}}function G(t,r){1&t&&(e.\u0275\u0275elementStart(0,"h3"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"abpLocalization"),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"SendTestEmail")))}function P(t,r){if(1&t){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"form",26),e.\u0275\u0275listener("ngSubmit",function(){e.\u0275\u0275restoreView(n);const o=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(o.emailTestFormSubmit())}),e.\u0275\u0275elementStart(1,"div",7)(2,"label",8),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"input",27),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",7)(7,"label",8),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(10,"input",28),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div",7)(12,"label",8),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(15,"input",29),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",7)(17,"label",8),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(20,"textarea",30),e.\u0275\u0275elementEnd()()}if(2&t){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("formGroup",n.emailTestForm),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,5,"AbpSettingManagement::SenderEmailAddress")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,7,"AbpSettingManagement::TargetEmailAddress")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,9,"AbpSettingManagement::Subject")),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(19,11,"AbpSettingManagement::Body"))}}function F(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"abp-button",31)(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"abpLocalization"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"button",32),e.\u0275\u0275text(5,"Close"),e.\u0275\u0275elementEnd()),2&t){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",n.emailTestForm.invalid&&n.emailTestForm.dirty),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,2,"AbpTenantManagement::Send"))}}let E=(()=>{class t{constructor(n){this.restService=n,this.apiName="SettingManagement",this.get=()=>this.restService.request({method:"GET",url:"/api/setting-management/emailing"},{apiName:this.apiName}),this.sendTestEmail=a=>this.restService.request({method:"POST",url:"/api/setting-management/emailing/send-test-email",body:a},{apiName:this.apiName}),this.update=a=>this.restService.request({method:"POST",url:"/api/setting-management/emailing",body:a},{apiName:this.apiName})}static#e=this.\u0275fac=function(a){return new(a||t)(e.\u0275\u0275inject(l.RestService))};static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),S=(()=>{class t{constructor(n,a,o){this.emailSettingsService=n,this.fb=a,this.toasterService=o,this.saving=!1,this.emailingPolicy="SettingManagement.Emailing",this.isEmailTestModalOpen=!1,this.modalSize={size:"lg"}}ngOnInit(){this.getData()}getData(){this.emailSettingsService.get().subscribe(n=>{this.buildForm(n)})}buildForm(n){this.form=this.fb.group({defaultFromDisplayName:[n.defaultFromDisplayName,[i.Validators.required]],defaultFromAddress:[n.defaultFromAddress,[i.Validators.required]],smtpHost:[n.smtpHost],smtpPort:[n.smtpPort,[i.Validators.required]],smtpEnableSsl:[n.smtpEnableSsl],smtpUseDefaultCredentials:[n.smtpUseDefaultCredentials],smtpDomain:[n.smtpDomain],smtpUserName:[n.smtpUserName],smtpPassword:[n.smtpPassword]})}submit(){this.saving||this.form.invalid||(this.saving=!0,this.emailSettingsService.update(this.form.value).pipe((0,p.finalize)(()=>this.saving=!1)).subscribe(()=>{this.toasterService.success("AbpSettingManagement::SuccessfullySaved"),this.getData()}))}openSendEmailModal(){this.buildEmailTestForm(),this.isEmailTestModalOpen=!0}buildEmailTestForm(){this.emailTestForm=this.fb.group({senderEmailAddress:["",[i.Validators.required,i.Validators.email]],targetEmailAddress:["",[i.Validators.required,i.Validators.email]],subject:["",[i.Validators.required]],body:[""]})}emailTestFormSubmit(){this.emailTestForm.invalid||this.emailSettingsService.sendTestEmail(this.emailTestForm.value).subscribe(n=>{this.toasterService.success("AbpSettingManagement::SuccessfullySent"),this.isEmailTestModalOpen=!1})}static#e=this.\u0275fac=function(a){return new(a||t)(e.\u0275\u0275directiveInject(E),e.\u0275\u0275directiveInject(i.UntypedFormBuilder),e.\u0275\u0275directiveInject(s.ToasterService))};static#t=this.\u0275cmp=e.\u0275\u0275defineComponent({type:t,selectors:[["abp-email-setting-group"]],decls:12,vars:6,consts:[[1,"my-3"],[3,"formGroup","validateOnSubmit","ngSubmit",4,"ngIf"],[3,"visible","options","visibleChange"],["abpHeader",""],["abpBody",""],["abpFooter",""],[3,"formGroup","validateOnSubmit","ngSubmit"],[1,"mb-3","form-group"],[1,"form-label"],[1,"ms-1"],["type","text","formControlName","defaultFromDisplayName",1,"form-control"],["type","text","formControlName","defaultFromAddress",1,"form-control"],["type","text","formControlName","smtpHost",1,"form-control"],["type","number","formControlName","smtpPort",1,"form-control"],[1,"form-check","mb-2"],["type","checkbox","id","smtp-enable-ssl","formControlName","smtpEnableSsl",1,"form-check-input"],["for","smtp-enable-ssl",1,"form-check-label"],["type","checkbox","id","smtp-use-default-credentials","formControlName","smtpUseDefaultCredentials",1,"form-check-input"],["for","smtp-use-default-credentials",1,"form-check-label"],["type","text","formControlName","smtpDomain",1,"form-control"],["type","text","formControlName","smtpUserName",1,"form-control"],["type","password","formControlName","smtpPassword",1,"form-control"],["type","submit",1,"btn","btn-primary"],["type","button","class","btn btn-primary mx-2",3,"click",4,"abpPermission"],["type","button",1,"btn","btn-primary","mx-2",3,"click"],["aria-hidden","true",1,"fa","f-send"],["id","emailTestForm",3,"formGroup","ngSubmit"],["formControlName","senderEmailAddress",1,"form-control"],["formControlName","targetEmailAddress",1,"form-control"],["formControlName","subject",1,"form-control"],["formControlName","body",1,"form-control"],["buttonType","submit","iconClass","fa fa-send","formName","emailTestForm",3,"disabled"],["type","button","abpClose","",1,"btn","btn-secondary"]],template:function(a,o){1&a&&(e.\u0275\u0275elementStart(0,"h2"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"abpLocalization"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"hr",0),e.\u0275\u0275template(4,D,58,38,"form",1),e.\u0275\u0275elementStart(5,"abp-modal",2),e.\u0275\u0275listener("visibleChange",function(B){return o.isEmailTestModalOpen=B}),e.\u0275\u0275template(6,G,3,3,"ng-template",null,3,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(8,P,21,13,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(10,F,6,4,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()),2&a&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,4,"AbpSettingManagement::Menu:Emailing")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",o.form),e.\u0275\u0275advance(1),e.\u0275\u0275property("visible",o.isEmailTestModalOpen)("options",o.modalSize))},dependencies:[A.NgIf,i.\u0275NgNoValidate,i.DefaultValueAccessor,i.NumberValueAccessor,i.CheckboxControlValueAccessor,i.NgControlStatus,i.NgControlStatusGroup,i.FormGroupDirective,i.FormControlName,l.FormSubmitDirective,l.PermissionDirective,d.ValidationGroupDirective,d.ValidationDirective,s.ButtonComponent,s.ModalComponent,s.ModalCloseDirective,l.LocalizationPipe],encapsulation:2,data:{animation:[s.collapse]}})}return t})(),c=(()=>{class t extends l.AbstractNavTreeService{static#e=this.\u0275fac=function(){let n;return function(o){return(n||(n=e.\u0275\u0275getInheritedFactory(t)))(o||t)}}();static#t=this.\u0275prov=e.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function f(t){return()=>{t.add([{name:"AbpSettingManagement::Settings",path:"/setting-management",parentName:"AbpUiNavigation::Menu:Administration",layout:"application",order:100,iconClass:"fa fa-cog"}])}}const u=new e.InjectionToken("SETTING_MANAGEMENT_HAS_SETTING",{factory:()=>(0,e.inject)(c).visible$.pipe((0,p.debounceTime)(0),(0,p.map)(r=>!!r.length))}),b=[{provide:e.APP_INITIALIZER,useFactory:f,deps:[l.RoutesService],multi:!0},{provide:e.APP_INITIALIZER,useFactory:l.noop,deps:[u],multi:!0}],_=[{provide:e.APP_INITIALIZER,useFactory:v,deps:[c],multi:!0}];function v(t){return()=>{t.add([{name:"AbpSettingManagement::Menu:Emailing",order:100,requiredPolicy:"SettingManagement.Emailing",component:S}])}}const R=new e.InjectionToken("SETTING_MANAGEMENT_FEATURES",{providedIn:"root",factory:()=>{const t=(0,e.inject)(l.ConfigStateService),r="SettingManagement.Enable";return(0,l.featuresFactory)(t,[r],a=>({enable:"false"!==a[r].toLowerCase()}))}}),T=new e.InjectionToken("SETTING_MANAGEMENT_ROUTE_VISIBILITY",{providedIn:"root",factory:()=>(0,e.inject)(R).pipe((0,p.map)(r=>r.enable))}),L=[{provide:e.APP_INITIALIZER,useFactory:l.noop,deps:[T],multi:!0}],I=[{provide:e.APP_INITIALIZER,useFactory:M,deps:[e.Injector],multi:!0}];function M(t){return()=>{const r=t.get(u),n=t.get(T),a=t.get(l.RoutesService);(0,h.combineLatest)([r,n]).subscribe(([o,N])=>{a.patch("AbpSettingManagement::Settings",{invisible:!(o&&N)})})}}let O=(()=>{class t{static forRoot(){return{ngModule:t,providers:[b,_,L,I]}}static#e=this.\u0275fac=function(a){return new(a||t)};static#t=this.\u0275mod=e.\u0275\u0275defineNgModule({type:t});static#n=this.\u0275inj=e.\u0275\u0275defineInjector({imports:[l.CoreModule,s.ThemeSharedModule,d.NgxValidateCoreModule]})}return t})()}}]);